(function(m,l,y,i,d,p,t,n){"use strict";const I={apiKey:"",serverUrl:""},c=()=>({...I,...p.storage}),v=r=>{Object.assign(p.storage,r)},A=r=>{const e=c();e.apiKey=r,v(e)},f=r=>{const e=c();e.serverUrl=r,v(e)},R=()=>c().apiKey,F=()=>c().serverUrl,w=()=>{const r=c();return r.apiKey.trim()!==""&&r.serverUrl.trim()!==""};d.findByProps("openLazy","hideActionSheet");const u=d.findByProps("ActionSheet")?.ActionSheet,g=d.findByProps("ActionSheetRow")?.ActionSheetRow;let S;var E={onLoad:()=>{console.log("[ImmichSave] Plugin loaded!"),u?(console.log("[ImmichSave] Found ActionSheet component, patching render method"),S=y.before("render",u,r=>{try{const[e]=r;console.log("[ImmichSave] ActionSheet render - full props:",{sheetKey:e.sheetKey,hasOptions:!!e.options,optionsCount:e.options?.length||0,allPropKeys:Object.keys(e),hasMessage:!!e.message,hasContent:!!e.content,hasData:!!e.data,title:e.title,header:e.header});const o=e.header?.props?.message;if(!o){console.log("[ImmichSave] Skipping ActionSheet - no message found in header.props");return}if(!o.attachments?.some(a=>a.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(a.filename))){console.log("[ImmichSave] Skipping - no image attachments found");return}if(console.log("[ImmichSave] Found message with image attachments - proceeding"),console.log("[ImmichSave] Children debug:",{hasChildren:!!e.children,childrenType:typeof e.children,childrenIsArray:Array.isArray(e.children),childrenLength:e.children?.length,children:e.children}),e.children&&Array.isArray(e.children)&&g)if(console.log("[ImmichSave] Attempting to add ActionSheetRow to children"),e.children.some(a=>a?.props?.label==="Save to Immich"))console.log("[ImmichSave] Save to Immich option already exists");else{const a=t.React.createElement(g,{key:"save-to-immich",label:"Save to Immich",icon:i.getAssetIDByName("ic_download"),onPress:()=>{try{console.log("[ImmichSave] Save to Immich pressed!"),console.log("[ImmichSave] Message attachments:",o.attachments);const s=o.attachments.filter(h=>h.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(h.filename));l.showToast(`Found ${s.length} image(s) to save! (functionality coming soon)`,i.getAssetIDByName("ic_check"))}catch(s){console.error("[ImmichSave] Error in Save to Immich handler:",s),l.showToast("Error occurred",i.getAssetIDByName("ic_close_16px"))}}});e.children.unshift(a),console.log("[ImmichSave] Successfully added Save to Immich ActionSheetRow")}else console.log("[ImmichSave] Cannot add ActionSheetRow:",{hasChildren:!!e.children,isArray:Array.isArray(e.children),hasActionSheetRow:!!g})}catch(e){console.error("[ImmichSave] ActionSheet patch error:",e)}})):console.warn("[ImmichSave] Could not find ActionSheet component")},onUnload:()=>{S&&S()},settings:()=>{const[r,e]=t.React.useState(R()),[o,a]=t.React.useState(F()),s=()=>{A(r),l.showToast("API Key saved!",i.getAssetIDByName("ic_check"))},h=()=>{f(o),l.showToast("Server URL saved!",i.getAssetIDByName("ic_check"))};return t.React.createElement(t.React.Fragment,null,t.React.createElement(n.Forms.FormSection,{title:"Immich Configuration"},t.React.createElement(n.Forms.FormText,{style:{marginBottom:10}},"Configure your Immich server connection:"),t.React.createElement(n.Forms.FormInput,{placeholder:"Enter your Immich API Key",value:r,onChange:e,secureTextEntry:!0}),t.React.createElement(n.Forms.FormRow,{label:"Save API Key",onPress:s}),t.React.createElement(n.Forms.FormInput,{placeholder:"Enter Immich Server URL (e.g., https://immich.example.com)",value:o,onChange:a}),t.React.createElement(n.Forms.FormRow,{label:"Save Server URL",onPress:h})),t.React.createElement(n.Forms.FormSection,{title:"Status"},t.React.createElement(n.Forms.FormText,{style:{marginBottom:10}},w()?"\u2705 Immich is configured and ready to use!":"\u274C Please configure Immich settings above")))}};return m.default=E,Object.defineProperty(m,"__esModule",{value:!0}),m})({},vendetta.ui.toasts,vendetta.patcher,vendetta.ui.assets,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components);
