(function(m,s,y,l,g,p,t,n){"use strict";const S={apiKey:"",serverUrl:""},o=()=>({...S,...p.storage}),u=r=>{Object.assign(p.storage,r)},I=r=>{const e=o();e.apiKey=r,u(e)},f=r=>{const e=o();e.serverUrl=r,u(e)},A=()=>o().apiKey,F=()=>o().serverUrl,R=()=>{const r=o();return r.apiKey.trim()!==""&&r.serverUrl.trim()!==""};g.findByProps("openLazy","hideActionSheet");const v=g.findByProps("ActionSheet")?.ActionSheet;let d;var E={onLoad:()=>{console.log("[ImmichSave] Plugin loaded!"),v?(console.log("[ImmichSave] Found ActionSheet component, patching render method"),d=y.before("render",v,r=>{try{const[e]=r;console.log("[ImmichSave] ActionSheet render - full props:",{sheetKey:e.sheetKey,hasOptions:!!e.options,optionsCount:e.options?.length||0,allPropKeys:Object.keys(e),hasMessage:!!e.message,hasContent:!!e.content,hasData:!!e.data,title:e.title,header:e.header});const a=e.header?.props?.message;if(!a){console.log("[ImmichSave] Skipping ActionSheet - no message found in header.props");return}if(!a.attachments?.some(i=>i.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(i.filename))){console.log("[ImmichSave] Skipping - no image attachments found");return}if(console.log("[ImmichSave] Found message with image attachments - proceeding"),console.log("[ImmichSave] Children debug:",{hasChildren:!!e.children,childrenType:typeof e.children,childrenIsArray:Array.isArray(e.children),childrenLength:e.children?.length,children:e.children}),e.children&&Array.isArray(e.children)){console.log("[ImmichSave] Attempting to add option to children array");const i=t.React.createElement("div",{key:"save-to-immich",onClick:()=>{try{console.log("[ImmichSave] Save to Immich pressed!"),console.log("[ImmichSave] Message attachments:",a.attachments);const c=a.attachments.filter(h=>h.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(h.filename));s.showToast(`Found ${c.length} image(s) to save! (functionality coming soon)`,l.getAssetIDByName("ic_check"))}catch(c){console.error("[ImmichSave] Error in Save to Immich handler:",c),s.showToast("Error occurred",l.getAssetIDByName("ic_close_16px"))}}},"Save to Immich");e.children.unshift(i),console.log("[ImmichSave] Successfully added Save to Immich to children")}else console.log("[ImmichSave] Could not add option - children is not an array:",{hasChildren:!!e.children,childrenType:typeof e.children,isArray:Array.isArray(e.children)})}catch(e){console.error("[ImmichSave] ActionSheet patch error:",e)}})):console.warn("[ImmichSave] Could not find ActionSheet component")},onUnload:()=>{d&&d()},settings:()=>{const[r,e]=t.React.useState(A()),[a,i]=t.React.useState(F()),c=()=>{I(r),s.showToast("API Key saved!",l.getAssetIDByName("ic_check"))},h=()=>{f(a),s.showToast("Server URL saved!",l.getAssetIDByName("ic_check"))};return t.React.createElement(t.React.Fragment,null,t.React.createElement(n.Forms.FormSection,{title:"Immich Configuration"},t.React.createElement(n.Forms.FormText,{style:{marginBottom:10}},"Configure your Immich server connection:"),t.React.createElement(n.Forms.FormInput,{placeholder:"Enter your Immich API Key",value:r,onChange:e,secureTextEntry:!0}),t.React.createElement(n.Forms.FormRow,{label:"Save API Key",onPress:c}),t.React.createElement(n.Forms.FormInput,{placeholder:"Enter Immich Server URL (e.g., https://immich.example.com)",value:a,onChange:i}),t.React.createElement(n.Forms.FormRow,{label:"Save Server URL",onPress:h})),t.React.createElement(n.Forms.FormSection,{title:"Status"},t.React.createElement(n.Forms.FormText,{style:{marginBottom:10}},R()?"\u2705 Immich is configured and ready to use!":"\u274C Please configure Immich settings above")))}};return m.default=E,Object.defineProperty(m,"__esModule",{value:!0}),m})({},vendetta.ui.toasts,vendetta.patcher,vendetta.ui.assets,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components);
