(function(l,c,v,i,g,d,o,n){"use strict";const S={apiKey:"",serverUrl:""},s=()=>({...S,...d.storage}),p=t=>{Object.assign(d.storage,t)},I=t=>{const e=s();e.apiKey=t,p(e)},y=t=>{const e=s();e.serverUrl=t,p(e)},f=()=>s().apiKey,A=()=>s().serverUrl,F=()=>{const t=s();return t.apiKey.trim()!==""&&t.serverUrl.trim()!==""};g.findByProps("openLazy","hideActionSheet");const u=g.findByProps("ActionSheet")?.ActionSheet;let h;var R={onLoad:()=>{console.log("[ImmichSave] Plugin loaded!"),u?(console.log("[ImmichSave] Found ActionSheet component, patching render method"),h=v.before("render",u,t=>{try{const[e]=t;console.log("[ImmichSave] ActionSheet render - full props:",{sheetKey:e.sheetKey,hasOptions:!!e.options,optionsCount:e.options?.length||0,allPropKeys:Object.keys(e),hasMessage:!!e.message,hasContent:!!e.content,hasData:!!e.data,title:e.title,header:e.header});const r=e.header?.props?.message;if(!r){console.log("[ImmichSave] Skipping ActionSheet - no message found in header.props");return}if(!r.attachments?.some(a=>a.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(a.filename))){console.log("[ImmichSave] Skipping - no image attachments found");return}console.log("[ImmichSave] Found message with image attachments - proceeding"),e.options&&!e.options.some(a=>a?.label==="Save to Immich")&&(console.log("[ImmichSave] Adding Save to Immich option"),e.options.unshift({label:"Save to Immich",icon:i.getAssetIDByName("ic_download"),onPress:()=>{try{console.log("[ImmichSave] Save to Immich pressed!"),console.log("[ImmichSave] Message attachments:",r.attachments);const a=r.attachments.filter(m=>m.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(m.filename));c.showToast(`Found ${a.length} image(s) to save! (functionality coming soon)`,i.getAssetIDByName("ic_check")),e.hideActionSheet?.()}catch(a){console.error("[ImmichSave] Error in Save to Immich handler:",a),c.showToast("Error occurred",i.getAssetIDByName("ic_close_16px"))}}}),console.log("[ImmichSave] Successfully added Save to Immich option"))}catch(e){console.error("[ImmichSave] ActionSheet patch error:",e)}})):console.warn("[ImmichSave] Could not find ActionSheet component")},onUnload:()=>{h&&h()},settings:()=>{const[t,e]=o.React.useState(f()),[r,a]=o.React.useState(A()),m=()=>{I(t),c.showToast("API Key saved!",i.getAssetIDByName("ic_check"))},E=()=>{y(r),c.showToast("Server URL saved!",i.getAssetIDByName("ic_check"))};return o.React.createElement(o.React.Fragment,null,o.React.createElement(n.Forms.FormSection,{title:"Immich Configuration"},o.React.createElement(n.Forms.FormText,{style:{marginBottom:10}},"Configure your Immich server connection:"),o.React.createElement(n.Forms.FormInput,{placeholder:"Enter your Immich API Key",value:t,onChange:e,secureTextEntry:!0}),o.React.createElement(n.Forms.FormRow,{label:"Save API Key",onPress:m}),o.React.createElement(n.Forms.FormInput,{placeholder:"Enter Immich Server URL (e.g., https://immich.example.com)",value:r,onChange:a}),o.React.createElement(n.Forms.FormRow,{label:"Save Server URL",onPress:E})),o.React.createElement(n.Forms.FormSection,{title:"Status"},o.React.createElement(n.Forms.FormText,{style:{marginBottom:10}},F()?"\u2705 Immich is configured and ready to use!":"\u274C Please configure Immich settings above")))}};return l.default=R,Object.defineProperty(l,"__esModule",{value:!0}),l})({},vendetta.ui.toasts,vendetta.patcher,vendetta.ui.assets,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components);
