(function(m,c,v,s,p,g,o,n){"use strict";const S={apiKey:"",serverUrl:""},r=()=>({...S,...g.storage}),d=t=>{Object.assign(g.storage,t)},y=t=>{const e=r();e.apiKey=t,d(e)},I=t=>{const e=r();e.serverUrl=t,d(e)},f=()=>r().apiKey,A=()=>r().serverUrl,F=()=>{const t=r();return t.apiKey.trim()!==""&&t.serverUrl.trim()!==""};p.findByProps("openLazy","hideActionSheet");const u=p.findByProps("ActionSheet")?.ActionSheet;let h;var R={onLoad:()=>{console.log("[ImmichSave] Plugin loaded!"),u?(console.log("[ImmichSave] Found ActionSheet component, patching render method"),h=v.before("render",u,t=>{try{const[e]=t;console.log("[ImmichSave] ActionSheet render - full props:",{sheetKey:e.sheetKey,hasOptions:!!e.options,optionsCount:e.options?.length||0,allPropKeys:Object.keys(e),hasMessage:!!e.message,hasContent:!!e.content,hasData:!!e.data,title:e.title,header:e.header});const i=e.header?.props?.message;if(!i){console.log("[ImmichSave] Skipping ActionSheet - no message found in header.props");return}if(!i.attachments?.some(a=>a.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(a.filename))){console.log("[ImmichSave] Skipping - no image attachments found");return}console.log("[ImmichSave] Found message with image attachments - proceeding"),console.log("[ImmichSave] Options debug:",{hasOptions:!!e.options,optionsType:typeof e.options,optionsLength:e.options?.length,optionsIsArray:Array.isArray(e.options),firstOption:e.options?.[0],allOptions:e.options}),e.options&&Array.isArray(e.options)&&!e.options.some(a=>a?.label==="Save to Immich")?(console.log("[ImmichSave] Adding Save to Immich option to options array"),e.options.unshift({label:"Save to Immich",icon:s.getAssetIDByName("ic_download"),onPress:()=>{try{console.log("[ImmichSave] Save to Immich pressed!"),console.log("[ImmichSave] Message attachments:",i.attachments);const a=i.attachments.filter(l=>l.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(l.filename));c.showToast(`Found ${a.length} image(s) to save! (functionality coming soon)`,s.getAssetIDByName("ic_check")),e.hideActionSheet?.()}catch(a){console.error("[ImmichSave] Error in Save to Immich handler:",a),c.showToast("Error occurred",s.getAssetIDByName("ic_close_16px"))}}}),console.log("[ImmichSave] Successfully added Save to Immich option")):console.log("[ImmichSave] Could not add option - options check failed:",{hasOptions:!!e.options,isArray:Array.isArray(e.options),alreadyExists:e.options?.some(a=>a?.label==="Save to Immich")})}catch(e){console.error("[ImmichSave] ActionSheet patch error:",e)}})):console.warn("[ImmichSave] Could not find ActionSheet component")},onUnload:()=>{h&&h()},settings:()=>{const[t,e]=o.React.useState(f()),[i,a]=o.React.useState(A()),l=()=>{y(t),c.showToast("API Key saved!",s.getAssetIDByName("ic_check"))},b=()=>{I(i),c.showToast("Server URL saved!",s.getAssetIDByName("ic_check"))};return o.React.createElement(o.React.Fragment,null,o.React.createElement(n.Forms.FormSection,{title:"Immich Configuration"},o.React.createElement(n.Forms.FormText,{style:{marginBottom:10}},"Configure your Immich server connection:"),o.React.createElement(n.Forms.FormInput,{placeholder:"Enter your Immich API Key",value:t,onChange:e,secureTextEntry:!0}),o.React.createElement(n.Forms.FormRow,{label:"Save API Key",onPress:l}),o.React.createElement(n.Forms.FormInput,{placeholder:"Enter Immich Server URL (e.g., https://immich.example.com)",value:i,onChange:a}),o.React.createElement(n.Forms.FormRow,{label:"Save Server URL",onPress:b})),o.React.createElement(n.Forms.FormSection,{title:"Status"},o.React.createElement(n.Forms.FormText,{style:{marginBottom:10}},F()?"\u2705 Immich is configured and ready to use!":"\u274C Please configure Immich settings above")))}};return m.default=R,Object.defineProperty(m,"__esModule",{value:!0}),m})({},vendetta.ui.toasts,vendetta.patcher,vendetta.ui.assets,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components);
