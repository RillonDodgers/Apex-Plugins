(function(i,h,y,d,m,p,r,a){"use strict";const v={apiKey:"",serverUrl:""},o=()=>({...v,...p.storage}),g=t=>{Object.assign(p.storage,t)},S=t=>{const e=o();e.apiKey=t,g(e)},I=t=>{const e=o();e.serverUrl=t,g(e)},f=()=>o().apiKey,A=()=>o().serverUrl,F=()=>{const t=o();return t.apiKey.trim()!==""&&t.serverUrl.trim()!==""};m.findByProps("openLazy","hideActionSheet");const u=m.findByProps("ActionSheet")?.ActionSheet;let c;var R={onLoad:()=>{console.log("[ImmichSave] Plugin loaded!"),u?(console.log("[ImmichSave] Found ActionSheet component, patching render method"),c=y.before("render",u,t=>{try{const[e]=t;console.log("[ImmichSave] ActionSheet render - full props:",{sheetKey:e.sheetKey,hasOptions:!!e.options,optionsCount:e.options?.length||0,allPropKeys:Object.keys(e),hasMessage:!!e.message,hasContent:!!e.content,hasData:!!e.data,title:e.title,header:e.header});const s=e.header?.props?.message;if(!s){console.log("[ImmichSave] Skipping ActionSheet - no message found in header.props");return}if(!s.attachments?.some(n=>n.content_type?.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(n.filename))){console.log("[ImmichSave] Skipping - no image attachments found");return}console.log("[ImmichSave] Found message with image attachments - proceeding"),console.log("[ImmichSave] Children debug:",{hasChildren:!!e.children,childrenType:typeof e.children,childrenIsArray:Array.isArray(e.children),childrenLength:e.children?.length,children:e.children}),e.children?Array.isArray(e.children)?(console.log("[ImmichSave] Children is array with length:",e.children.length),e.children.forEach((n,l)=>{console.log(`[ImmichSave] Child ${l}:`,{type:n?.type?.name||n?.type,props:n?.props?Object.keys(n.props):"no props",hasOnPress:!!n?.props?.onPress,label:n?.props?.label||n?.props?.children})})):console.log("[ImmichSave] Children is not array:",{type:e.children?.type?.name||e.children?.type,props:e.children?.props?Object.keys(e.children.props):"no props"}):console.log("[ImmichSave] No children found")}catch(e){console.error("[ImmichSave] ActionSheet patch error:",e)}})):console.warn("[ImmichSave] Could not find ActionSheet component")},onUnload:()=>{c&&c()},settings:()=>{const[t,e]=r.React.useState(f()),[s,n]=r.React.useState(A()),l=()=>{S(t),h.showToast("API Key saved!",d.getAssetIDByName("ic_check"))},b=()=>{I(s),h.showToast("Server URL saved!",d.getAssetIDByName("ic_check"))};return r.React.createElement(r.React.Fragment,null,r.React.createElement(a.Forms.FormSection,{title:"Immich Configuration"},r.React.createElement(a.Forms.FormText,{style:{marginBottom:10}},"Configure your Immich server connection:"),r.React.createElement(a.Forms.FormInput,{placeholder:"Enter your Immich API Key",value:t,onChange:e,secureTextEntry:!0}),r.React.createElement(a.Forms.FormRow,{label:"Save API Key",onPress:l}),r.React.createElement(a.Forms.FormInput,{placeholder:"Enter Immich Server URL (e.g., https://immich.example.com)",value:s,onChange:n}),r.React.createElement(a.Forms.FormRow,{label:"Save Server URL",onPress:b})),r.React.createElement(a.Forms.FormSection,{title:"Status"},r.React.createElement(a.Forms.FormText,{style:{marginBottom:10}},F()?"\u2705 Immich is configured and ready to use!":"\u274C Please configure Immich settings above")))}};return i.default=R,Object.defineProperty(i,"__esModule",{value:!0}),i})({},vendetta.ui.toasts,vendetta.patcher,vendetta.ui.assets,vendetta.metro,vendetta.plugin,vendetta.metro.common,vendetta.ui.components);
