(function(F,u,l,s,S,M,a,c){"use strict";const k={excludedServers:[],excludedDMs:[]},f=()=>({...k,...M.storage}),v=t=>{Object.assign(M.storage,t)},L=t=>{const e=f();return e.excludedServers.includes(t)?!1:(e.excludedServers.push(t),v(e),!0)},U=t=>{const e=f(),r=e.excludedServers.indexOf(t);return r>-1?(e.excludedServers.splice(r,1),v(e),!0):!1},$=t=>{const e=f();return e.excludedDMs.includes(t)?!1:(e.excludedDMs.push(t),v(e),!0)},O=t=>{const e=f(),r=e.excludedDMs.indexOf(t);return r>-1?(e.excludedDMs.splice(r,1),v(e),!0):!1},j=t=>f().excludedServers.includes(t),G=t=>f().excludedDMs.includes(t),J=t=>{try{return u.findByStoreName("GuildStore")?.getGuild?.(t)?.name||`Unknown Server (${t})`}catch{return`Unknown Server (${t})`}},K=t=>{try{const e=u.findByStoreName("ChannelStore")?.getChannel?.(t);if(e){if(e.name)return e.name;if(e.recipients&&e.recipients.length>0){const r=u.findByStoreName("UserStore")?.getUser?.(e.recipients[0]);return r?.username?`@${r.username}`:`Unknown User (${t})`}}return`Unknown DM (${t})`}catch{return`Unknown DM (${t})`}},V=()=>{const t=f();t.excludedServers=[],t.excludedDMs=[],v(t)},_=()=>{const t=f();return{servers:t.excludedServers.map(e=>({id:e,name:J(e)})),dms:t.excludedDMs.map(e=>({id:e,name:K(e)}))}};let p,R,B,d,b,I,x=null,E=null,A=null,D=null,m=0;const y=6e4,Q=()=>{p=u.findByStoreName("GuildStore"),R=u.findByStoreName("GuildChannelStore")||u.findByStoreName("ChannelStore"),I=u.findByStoreName("ChannelStore"),d=u.findByStoreName("ReadStateStore"),B=u.findByStoreName("ActiveJoinedThreadsStore")||u.findByProps("getActiveJoinedThreadsForGuild"),b=u.findByProps("dispatch","subscribe")||u.findByStoreName("Dispatcher")},q=()=>{const t=[],e=I||R;if(!e)return t;if(e.getPrivateChannels)try{const r=e.getPrivateChannels();r&&typeof r=="object"&&Object.values(r).forEach(n=>{n&&n.id&&t.push(n)})}catch{}if(t.length===0&&e.getSortedPrivateChannels)try{const r=e.getSortedPrivateChannels();Array.isArray(r)&&r.forEach(n=>{n&&n.id&&t.push(n)})}catch{}if(t.length===0&&e.getChannels)try{const r=e.getChannels("@me");r&&r.SELECTABLE&&r.SELECTABLE.forEach(n=>{const i=n.channel||n;i&&i.id&&t.push(i)})}catch{}if(t.length===0&&e.getChannel&&d?.getAllReadStates)try{const r=d.getAllReadStates();Object.keys(r).forEach(n=>{try{const i=e.getChannel(n);i&&(i.type===1||i.type===3||!i.guild_id&&!i.guildId)&&t.push(i)}catch{}})}catch{}return t},N=()=>{if(!p||!d)return[];const t=[],e=p.getGuilds();return Object.values(e).forEach(r=>{if(r?.id)try{let n=[];const i=R||I;if(i?.getChannels){const g=i.getChannels(r.id);g?.SELECTABLE&&(n=n.concat(g.SELECTABLE)),g?.VOCAL&&(n=n.concat(g.VOCAL))}if(B?.getActiveJoinedThreadsForGuild)try{const g=B.getActiveJoinedThreadsForGuild(r.id),h=Object.values(g).flatMap(w=>Object.values(w||{}));n=n.concat(h)}catch{}n.forEach(g=>{const h=g?.channel||g;if(h?.id&&!j(r.id))try{d.hasUnread&&d.hasUnread(h.id)&&t.push({channelId:h.id,messageId:d.lastMessageId?.(h.id)||null,readStateType:0})}catch{}})}catch{}}),t},T=()=>{const t=[];return q().forEach(e=>{if(e?.id&&!G(e.id))try{let r=!1;if(d.hasUnread&&(r=d.hasUnread(e.id)),!r&&d.getAllReadStates){const n=d.getAllReadStates()[e.id];n&&(r=n.mentionCount&&n.mentionCount>0||n._unreadCount&&n._unreadCount>0||n.unreadCount&&n.unreadCount>0)}r&&t.push({channelId:e.id,messageId:d.lastMessageId?.(e.id)||null,readStateType:0})}catch{}}),t},C=(t="all")=>{if(!p||!d||!b)return!1;let e=[],r="";switch(t){case"server":e=N(),r="server";break;case"dm":e=T(),r="DM";break;case"all":default:e=[...N(),...T()],r="";break}if(e.length===0){const i=t==="all"?"No unread notifications found!":`No unread ${r} notifications found!`;return l.showToast(i,s.getAssetIDByName("ic_message_edit")),!0}b.dispatch({type:"BULK_ACK",context:"APP",channels:e});const n=t==="all"?`Cleared ${e.length} unread notifications!`:`Cleared ${e.length} unread ${r} notifications!`;return l.showToast(n,s.getAssetIDByName("ic_message_edit")),!0},z=()=>{const t=Date.now(),e=t-m;if(e<y){const r=Math.ceil((y-e)/1e3);l.showToast(`Please wait ${r}s before using again`,s.getAssetIDByName("ic_close_16px"));return}m=t,C("all")},H=()=>{const t=Date.now(),e=t-m;if(e<y){const r=Math.ceil((y-e)/1e3);l.showToast(`Please wait ${r}s before using again`,s.getAssetIDByName("ic_close_16px"));return}m=t,C("server")},W=()=>{const t=Date.now(),e=t-m;if(e<y){const r=Math.ceil((y-e)/1e3);l.showToast(`Please wait ${r}s before using again`,s.getAssetIDByName("ic_close_16px"));return}m=t,C("server")},X=()=>{const t=Date.now(),e=t-m;if(e<y){const r=Math.ceil((y-e)/1e3);l.showToast(`Please wait ${r}s before using again`,s.getAssetIDByName("ic_close_16px"));return}m=t,C("dm")};var Y={onLoad:()=>{Q();try{x=S.registerCommand({name:"read",description:"Clear all unread notifications",applicationId:"-1",execute:()=>{z()}}),E=S.registerCommand({name:"read all",description:"Clear server unread notifications only",applicationId:"-1",execute:()=>{H()}}),A=S.registerCommand({name:"read server",description:"Clear server unread notifications only",applicationId:"-1",execute:()=>{W()}}),D=S.registerCommand({name:"read dm",description:"Clear DM unread notifications only",applicationId:"-1",execute:()=>{X()}})}catch{}},onUnload:()=>{if(x)try{x(),x=null}catch{}if(E)try{E(),E=null}catch{}if(A)try{A(),A=null}catch{}if(D)try{D(),D=null}catch{}},settings:()=>{const[t,e]=a.React.useState(""),[r,n]=a.React.useState(""),[i,g]=a.React.useState(_()),h=()=>{g(_())},w=()=>{t.trim()&&(L(t.trim())?(l.showToast("Added server to exceptions",s.getAssetIDByName("ic_check")),e(""),h()):l.showToast("Server already in exceptions",s.getAssetIDByName("ic_close_16px")))},P=()=>{r.trim()&&($(r.trim())?(l.showToast("Added DM to exceptions",s.getAssetIDByName("ic_check")),n(""),h()):l.showToast("DM already in exceptions",s.getAssetIDByName("ic_close_16px")))},Z=o=>{U(o),l.showToast("Server removed from exceptions",s.getAssetIDByName("ic_check")),h()},ee=o=>{O(o),l.showToast("DM removed from exceptions",s.getAssetIDByName("ic_check")),h()},te=()=>{V(),l.showToast("All exceptions cleared",s.getAssetIDByName("ic_check")),h()};return a.React.createElement(a.React.Fragment,null,a.React.createElement(c.Forms.FormSection,{title:"Server Exceptions"},a.React.createElement(c.Forms.FormText,{style:{marginBottom:10}},"Add server IDs to exclude from notification clearing:"),a.React.createElement(c.Forms.FormInput,{placeholder:"Enter server ID (e.g., 1325923169164333178)",value:t,onChange:e,onSubmitEditing:w}),a.React.createElement(c.Forms.FormRow,{label:"Add Server",onPress:w}),i.servers.map((o,re)=>a.React.createElement(c.Forms.FormRow,{key:o.id,label:o.name,subLabel:o.id,trailing:a.React.createElement(c.Forms.FormRow,{label:"Remove",style:{color:"#ff4757"},onPress:()=>Z(o.id)})}))),a.React.createElement(c.Forms.FormSection,{title:"DM Exceptions"},a.React.createElement(c.Forms.FormText,{style:{marginBottom:10}},"Add channel IDs to exclude from notification clearing:"),a.React.createElement(c.Forms.FormInput,{placeholder:"Enter channel ID (e.g., 1258452286682697890)",value:r,onChange:n,onSubmitEditing:P}),a.React.createElement(c.Forms.FormRow,{label:"Add DM",onPress:P}),i.dms.map((o,re)=>a.React.createElement(c.Forms.FormRow,{key:o.id,label:o.name,subLabel:o.id,trailing:a.React.createElement(c.Forms.FormRow,{label:"Remove",style:{color:"#ff4757"},onPress:()=>ee(o.id)})}))),a.React.createElement(c.Forms.FormSection,{title:"Actions"},a.React.createElement(c.Forms.FormRow,{label:"Clear All Exceptions",onPress:te})))}};return F.default=Y,Object.defineProperty(F,"__esModule",{value:!0}),F})({},vendetta.metro,vendetta.ui.toasts,vendetta.ui.assets,vendetta.commands,vendetta.plugin,vendetta.metro.common,vendetta.ui.components);
