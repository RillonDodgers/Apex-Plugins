(function(h,r,w,f){"use strict";const B=f.findByProps("sendMessage","receiveMessage"),c=f.findByProps("sendBotMessage");let m={},g={},M,y,v;function C(t,n,s){const e=`${t}:${s}`,o=s-Date.now();return g[e]={content:n,at:s},m[e]=setTimeout(()=>{const a=n,i=Date.now().toString();B.sendMessage(t,{content:a},void 0,{nonce:i}),delete m[e],delete g[e],w.showToast("Scheduled message sent.")},o),e}function D(){Object.values(m).forEach(clearTimeout),m={},g={}}function I(t){const n=new Date;t=t.toLowerCase();const s=/(\d+)(h|m|s)/g;let e=0,o;for(;(o=s.exec(t))!==null;){const d=parseInt(o[1]),u=o[2];u==="h"?e+=d*3600*1e3:u==="m"?e+=d*60*1e3:u==="s"&&(e+=d*1e3)}if(e>0)return Date.now()+e;const a=/^(\d{1,2}):(\d{2})(am|pm)?$/,i=t.match(a);if(i){let d=parseInt(i[1]);const u=parseInt(i[2]),p=i[3];p&&(p==="pm"&&d<12?d+=12:p==="am"&&d===12&&(d=0));const l=new Date(n);return l.setHours(d,u,0,0),l.getTime()<=n.getTime()&&l.setDate(l.getDate()+1),l.getTime()}return 0}function $(){M=r.registerCommand({name:"schedule",displayName:"schedule",description:"Schedule a message after a delay or at a time",options:[{name:"time",description:"Delay (e.g. 10s, 1h30m) or time (3:30pm, 15:30)",type:3,required:!0},{name:"message",description:"Message to send",type:3,required:!0}],execute:(t,n)=>{const s=n.channel.id,e=t[0]?.value,o=t[1]?.value;if(typeof e!="string"||e.trim()==="")return c.sendBotMessage(s,"Invalid time value!");if(typeof o!="string"||o.trim()==="")return c.sendBotMessage(s,"Message cannot be empty!");const a=I(e);if(a===0||a<=Date.now())return c.sendBotMessage(s,"Invalid or past time specified!");C(s,o,a);const i=Math.round((a-Date.now())/1e3);c.sendBotMessage(s,`Scheduled message in ${i}s.`)}}),y=r.registerCommand({name:"scheduled",displayName:"scheduled",description:"List scheduled messages",execute:(t,n)=>{const s=n.channel.id,e=Object.entries(g).map(([o,a])=>`\u2022 **In ${Math.round((a.at-Date.now())/1e3)}s** \u2192 ${a.content}`);e.length===0?c.sendBotMessage(s,"No scheduled messages."):c.sendBotMessage(s,`Scheduled messages:
${e.join(`
`)}`)}}),v=r.registerCommand({name:"cancel-scheduled",displayName:"cancel-scheduled",description:"Cancel all scheduled messages",execute:(t,n)=>{const s=n.channel.id;D(),c.sendBotMessage(s,"All scheduled messages cancelled.")}})}function T(){D(),r.unregisterCommand(M),r.unregisterCommand(y),r.unregisterCommand(v)}return h.onLoad=$,h.onUnload=T,h})({},vendetta.commands,vendetta.ui.toasts,vendetta.metro);
